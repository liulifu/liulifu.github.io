
$.fn.serializeObject=function(){"use strict";var a={},b=function(b,c){var d=a[c.name];"undefined"!=typeof d&&d!==null?$.isArray(d)?d.push(c.value):a[c.name]=[d,c.value]:a[c.name]=c.value};return $.each(this.serializeArray(),b),a};;
var PARSEIT_UC;(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,d=e.filter,g=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,_=Object.keys,j=i.bind,w=function(n){return n instanceof w?n:this instanceof w?(this._wrapped=n,void 0):new w(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):n._=w,w.VERSION="1.4.4";var A=w.each=w.forEach=function(n,t,e){if(null!=n)if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a in n)if(w.has(n,a)&&t.call(e,n[a],a,n)===r)return};w.map=w.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e[e.length]=t.call(r,n,u,i)}),e)};var O="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=w.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(O);return r},w.reduceRight=w.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=w.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=w.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(O);return r},w.find=w.detect=function(n,t,r){var e;return E(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},w.filter=w.select=function(n,t,r){var e=[];return null==n?e:d&&n.filter===d?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&(e[e.length]=n)}),e)},w.reject=function(n,t,r){return w.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},w.every=w.all=function(n,t,e){t||(t=w.identity);var u=!0;return null==n?u:g&&n.every===g?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var E=w.some=w.any=function(n,t,e){t||(t=w.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};w.contains=w.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:E(n,function(n){return n===t})},w.invoke=function(n,t){var r=o.call(arguments,2),e=w.isFunction(t);return w.map(n,function(n){return(e?t:n[t]).apply(n,r)})},w.pluck=function(n,t){return w.map(n,function(n){return n[t]})},w.where=function(n,t,r){return w.isEmpty(t)?r?null:[]:w[r?"find":"filter"](n,function(n){for(var r in t)if(t[r]!==n[r])return!1;return!0})},w.findWhere=function(n,t){return w.where(n,t,!0)},w.max=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.max.apply(Math,n);if(!t&&w.isEmpty(n))return-1/0;var e={computed:-1/0,value:-1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a>=e.computed&&(e={value:n,computed:a})}),e.value},w.min=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.min.apply(Math,n);if(!t&&w.isEmpty(n))return 1/0;var e={computed:1/0,value:1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;e.computed>a&&(e={value:n,computed:a})}),e.value},w.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=w.random(r++),e[r-1]=e[t],e[t]=n}),e};var k=function(n){return w.isFunction(n)?n:function(t){return t[n]}};w.sortBy=function(n,t,r){var e=k(t);return w.pluck(w.map(n,function(n,t,u){return{value:n,index:t,criteria:e.call(r,n,t,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index<t.index?-1:1}),"value")};var F=function(n,t,r,e){var u={},i=k(t||w.identity);return A(n,function(t,a){var o=i.call(r,t,a,n);e(u,o,t)}),u};w.groupBy=function(n,t,r){return F(n,t,r,function(n,t,r){(w.has(n,t)?n[t]:n[t]=[]).push(r)})},w.countBy=function(n,t,r){return F(n,t,r,function(n,t){w.has(n,t)||(n[t]=0),n[t]++})},w.sortedIndex=function(n,t,r,e){r=null==r?w.identity:k(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;u>r.call(e,n[o])?i=o+1:a=o}return i},w.toArray=function(n){return n?w.isArray(n)?o.call(n):n.length===+n.length?w.map(n,w.identity):w.values(n):[]},w.size=function(n){return null==n?0:n.length===+n.length?n.length:w.keys(n).length},w.first=w.head=w.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:o.call(n,0,t)},w.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},w.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},w.rest=w.tail=w.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},w.compact=function(n){return w.filter(n,w.identity)};var R=function(n,t,r){return A(n,function(n){w.isArray(n)?t?a.apply(r,n):R(n,t,r):r.push(n)}),r};w.flatten=function(n,t){return R(n,t,[])},w.without=function(n){return w.difference(n,o.call(arguments,1))},w.uniq=w.unique=function(n,t,r,e){w.isFunction(t)&&(e=r,r=t,t=!1);var u=r?w.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:w.contains(a,r))||(a.push(r),i.push(n[e]))}),i},w.union=function(){return w.uniq(c.apply(e,arguments))},w.intersection=function(n){var t=o.call(arguments,1);return w.filter(w.uniq(n),function(n){return w.every(t,function(t){return w.indexOf(t,n)>=0})})},w.difference=function(n){var t=c.apply(e,o.call(arguments,1));return w.filter(n,function(n){return!w.contains(t,n)})},w.zip=function(){for(var n=o.call(arguments),t=w.max(w.pluck(n,"length")),r=Array(t),e=0;t>e;e++)r[e]=w.pluck(n,""+e);return r},w.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},w.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=w.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},w.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},w.range=function(n,t,r){1>=arguments.length&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=Array(e);e>u;)i[u++]=n,n+=r;return i},w.bind=function(n,t){if(n.bind===j&&j)return j.apply(n,o.call(arguments,1));var r=o.call(arguments,2);return function(){return n.apply(t,r.concat(o.call(arguments)))}},w.partial=function(n){var t=o.call(arguments,1);return function(){return n.apply(this,t.concat(o.call(arguments)))}},w.bindAll=function(n){var t=o.call(arguments,1);return 0===t.length&&(t=w.functions(n)),A(t,function(t){n[t]=w.bind(n[t],n)}),n},w.memoize=function(n,t){var r={};return t||(t=w.identity),function(){var e=t.apply(this,arguments);return w.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},w.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},w.defer=function(n){return w.delay.apply(w,[n,1].concat(o.call(arguments,1)))},w.throttle=function(n,t){var r,e,u,i,a=0,o=function(){a=new Date,u=null,i=n.apply(r,e)};return function(){var c=new Date,l=t-(c-a);return r=this,e=arguments,0>=l?(clearTimeout(u),u=null,a=c,i=n.apply(r,e)):u||(u=setTimeout(o,l)),i}},w.debounce=function(n,t,r){var e,u;return function(){var i=this,a=arguments,o=function(){e=null,r||(u=n.apply(i,a))},c=r&&!e;return clearTimeout(e),e=setTimeout(o,t),c&&(u=n.apply(i,a)),u}},w.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},w.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},w.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},w.after=function(n,t){return 0>=n?t():function(){return 1>--n?t.apply(this,arguments):void 0}},w.keys=_||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var r in n)w.has(n,r)&&(t[t.length]=r);return t},w.values=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push(n[r]);return t},w.pairs=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push([r,n[r]]);return t},w.invert=function(n){var t={};for(var r in n)w.has(n,r)&&(t[n[r]]=r);return t},w.functions=w.methods=function(n){var t=[];for(var r in n)w.isFunction(n[r])&&t.push(r);return t.sort()},w.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},w.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},w.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)w.contains(r,u)||(t[u]=n[u]);return t},w.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)null==n[r]&&(n[r]=t[r])}),n},w.clone=function(n){return w.isObject(n)?w.isArray(n)?n.slice():w.extend({},n):n},w.tap=function(n,t){return t(n),n};var I=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof w&&(n=n._wrapped),t instanceof w&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==t+"";case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;r.push(n),e.push(t);var a=0,o=!0;if("[object Array]"==u){if(a=n.length,o=a==t.length)for(;a--&&(o=I(n[a],t[a],r,e)););}else{var c=n.constructor,f=t.constructor;if(c!==f&&!(w.isFunction(c)&&c instanceof c&&w.isFunction(f)&&f instanceof f))return!1;for(var s in n)if(w.has(n,s)&&(a++,!(o=w.has(t,s)&&I(n[s],t[s],r,e))))break;if(o){for(s in t)if(w.has(t,s)&&!a--)break;o=!a}}return r.pop(),e.pop(),o};w.isEqual=function(n,t){return I(n,t,[],[])},w.isEmpty=function(n){if(null==n)return!0;if(w.isArray(n)||w.isString(n))return 0===n.length;for(var t in n)if(w.has(n,t))return!1;return!0},w.isElement=function(n){return!(!n||1!==n.nodeType)},w.isArray=x||function(n){return"[object Array]"==l.call(n)},w.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){w["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),w.isArguments(arguments)||(w.isArguments=function(n){return!(!n||!w.has(n,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(n){return"function"==typeof n}),w.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},w.isNaN=function(n){return w.isNumber(n)&&n!=+n},w.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},w.isNull=function(n){return null===n},w.isUndefined=function(n){return n===void 0},w.has=function(n,t){return f.call(n,t)},w.noConflict=function(){return n._=t,this},w.identity=function(n){return n},w.times=function(n,t,r){for(var e=Array(n),u=0;n>u;u++)e[u]=t.call(r,u);return e},w.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=w.invert(M.escape);var S={escape:RegExp("["+w.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+w.keys(M.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(n){w[n]=function(t){return null==t?"":(""+t).replace(S[n],function(t){return M[n][t]})}}),w.result=function(n,t){if(null==n)return null;var r=n[t];return w.isFunction(r)?r.call(n):r},w.mixin=function(n){A(w.functions(n),function(t){var r=w[t]=n[t];w.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),D.call(this,r.apply(w,n))}})};var N=0;w.uniqueId=function(n){var t=++N+"";return n?n+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,q={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(n,t,r){var e;r=w.defaults({},r,w.templateSettings);var u=RegExp([(r.escape||T).source,(r.interpolate||T).source,(r.evaluate||T).source].join("|")+"|$","g"),i=0,a="__p+='";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(B,function(n){return"\\"+q[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),u&&(a+="';\n"+u+"\n__p+='"),i=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,w);var c=function(n){return e.call(this,n,w)};return c.source="function("+(r.variable||"obj")+"){\n"+a+"}",c},w.chain=function(n){return w(n).chain()};var D=function(n){return this._chain?w(n).chain():n};w.mixin(w),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];w.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],D.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];w.prototype[n]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}});PARSEIT_UC=_;}).call(this);;
!function(e,r){if("function"==typeof define&&define.amd)define(["exports"],r);else if("undefined"!=typeof exports)r(exports);else{var n={exports:{}};r(n.exports),e.ellipsed=n.exports}}(this,(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};function n(e,n){var i=e.el,t=e.elStyle,o=e.elHeight,l=e.rowsLimit,s=e.rowsWrapped,d=e.options,p=e.buffer,a=p;if(s===l+1)return r({},e);var f=p,u=s,c=o;return i.innerHTML=a=p.length?""+p+d.delimiter+n+d.replaceStr:""+n+d.replaceStr,parseFloat(t.height)>parseFloat(o)&&(u++,c=t.height,u===l+1)?(i.innerHTML=a="."===f[f.length-1]&&"..."===d.replaceStr?f+"..":""+f+d.replaceStr,r({},e,{elHeight:c,rowsWrapped:u})):(i.innerHTML=a=f.length?""+f+d.delimiter+n:""+n,r({},e,{buffer:a,elHeight:c,rowsWrapped:u}))}e.disableResponsive=function(e){window.removeEventListener("resize",e)},e.ellipsis=function e(){for(var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l={replaceStr:"...",responsive:!1,debounceDelay:250,delimiter:" "},s=r({},l,o),d=i&&(i instanceof NodeList?i:1===i.nodeType?[i]:document.querySelectorAll(i)),p=[],a=0;a<d.length;a++){var f=d[a];p[a]=f.innerHTML;var u=f.innerHTML.split(s.delimiter);f.innerHTML="";var c=window.getComputedStyle(f);u.reduce(n,{el:f,buffer:f.innerHTML,elStyle:c,elHeight:0,rowsLimit:t,rowsWrapped:0,options:s})}if(s.responsive){var v=!1,h=window.innerWidth,w=function(){if(window.innerWidth!==h){h=window.innerWidth;for(var n=0;n<d.length;n++)d[n].innerHTML=p[n];e(i,t,r({},o,{responsive:!1}))}},g=function(){clearTimeout(v),v=setTimeout(w,s.debounceDelay)};return window.addEventListener("resize",g),g}}}));;
var MD5=function(r){function n(o){if(t[o])return t[o].exports;var e=t[o]={i:o,l:!1,exports:{}};return r[o].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var t={};return n.m=r,n.c=t,n.i=function(r){return r},n.d=function(r,t,o){n.o(r,t)||Object.defineProperty(r,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return n.d(t,"a",t),t},n.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},n.p="",n(n.s=4)}([function(r,n){var t={utf8:{stringToBytes:function(r){return t.bin.stringToBytes(unescape(encodeURIComponent(r)))},bytesToString:function(r){return decodeURIComponent(escape(t.bin.bytesToString(r)))}},bin:{stringToBytes:function(r){for(var n=[],t=0;t<r.length;t++)n.push(255&r.charCodeAt(t));return n},bytesToString:function(r){for(var n=[],t=0;t<r.length;t++)n.push(String.fromCharCode(r[t]));return n.join("")}}};r.exports=t},function(r,n,t){!function(){var n=t(2),o=t(0).utf8,e=t(3),u=t(0).bin,i=function(r,t){r.constructor==String?r=t&&"binary"===t.encoding?u.stringToBytes(r):o.stringToBytes(r):e(r)?r=Array.prototype.slice.call(r,0):Array.isArray(r)||(r=r.toString());for(var f=n.bytesToWords(r),s=8*r.length,c=1732584193,a=-271733879,l=-1732584194,g=271733878,h=0;h<f.length;h++)f[h]=16711935&(f[h]<<8|f[h]>>>24)|4278255360&(f[h]<<24|f[h]>>>8);f[s>>>5]|=128<<s%32,f[14+(s+64>>>9<<4)]=s;for(var p=i._ff,y=i._gg,v=i._hh,d=i._ii,h=0;h<f.length;h+=16){var b=c,T=a,x=l,B=g;c=p(c,a,l,g,f[h+0],7,-680876936),g=p(g,c,a,l,f[h+1],12,-389564586),l=p(l,g,c,a,f[h+2],17,606105819),a=p(a,l,g,c,f[h+3],22,-1044525330),c=p(c,a,l,g,f[h+4],7,-176418897),g=p(g,c,a,l,f[h+5],12,1200080426),l=p(l,g,c,a,f[h+6],17,-1473231341),a=p(a,l,g,c,f[h+7],22,-45705983),c=p(c,a,l,g,f[h+8],7,1770035416),g=p(g,c,a,l,f[h+9],12,-1958414417),l=p(l,g,c,a,f[h+10],17,-42063),a=p(a,l,g,c,f[h+11],22,-1990404162),c=p(c,a,l,g,f[h+12],7,1804603682),g=p(g,c,a,l,f[h+13],12,-40341101),l=p(l,g,c,a,f[h+14],17,-1502002290),a=p(a,l,g,c,f[h+15],22,1236535329),c=y(c,a,l,g,f[h+1],5,-165796510),g=y(g,c,a,l,f[h+6],9,-1069501632),l=y(l,g,c,a,f[h+11],14,643717713),a=y(a,l,g,c,f[h+0],20,-373897302),c=y(c,a,l,g,f[h+5],5,-701558691),g=y(g,c,a,l,f[h+10],9,38016083),l=y(l,g,c,a,f[h+15],14,-660478335),a=y(a,l,g,c,f[h+4],20,-405537848),c=y(c,a,l,g,f[h+9],5,568446438),g=y(g,c,a,l,f[h+14],9,-1019803690),l=y(l,g,c,a,f[h+3],14,-187363961),a=y(a,l,g,c,f[h+8],20,1163531501),c=y(c,a,l,g,f[h+13],5,-1444681467),g=y(g,c,a,l,f[h+2],9,-51403784),l=y(l,g,c,a,f[h+7],14,1735328473),a=y(a,l,g,c,f[h+12],20,-1926607734),c=v(c,a,l,g,f[h+5],4,-378558),g=v(g,c,a,l,f[h+8],11,-2022574463),l=v(l,g,c,a,f[h+11],16,1839030562),a=v(a,l,g,c,f[h+14],23,-35309556),c=v(c,a,l,g,f[h+1],4,-1530992060),g=v(g,c,a,l,f[h+4],11,1272893353),l=v(l,g,c,a,f[h+7],16,-155497632),a=v(a,l,g,c,f[h+10],23,-1094730640),c=v(c,a,l,g,f[h+13],4,681279174),g=v(g,c,a,l,f[h+0],11,-358537222),l=v(l,g,c,a,f[h+3],16,-722521979),a=v(a,l,g,c,f[h+6],23,76029189),c=v(c,a,l,g,f[h+9],4,-640364487),g=v(g,c,a,l,f[h+12],11,-421815835),l=v(l,g,c,a,f[h+15],16,530742520),a=v(a,l,g,c,f[h+2],23,-995338651),c=d(c,a,l,g,f[h+0],6,-198630844),g=d(g,c,a,l,f[h+7],10,1126891415),l=d(l,g,c,a,f[h+14],15,-1416354905),a=d(a,l,g,c,f[h+5],21,-57434055),c=d(c,a,l,g,f[h+12],6,1700485571),g=d(g,c,a,l,f[h+3],10,-1894986606),l=d(l,g,c,a,f[h+10],15,-1051523),a=d(a,l,g,c,f[h+1],21,-2054922799),c=d(c,a,l,g,f[h+8],6,1873313359),g=d(g,c,a,l,f[h+15],10,-30611744),l=d(l,g,c,a,f[h+6],15,-1560198380),a=d(a,l,g,c,f[h+13],21,1309151649),c=d(c,a,l,g,f[h+4],6,-145523070),g=d(g,c,a,l,f[h+11],10,-1120210379),l=d(l,g,c,a,f[h+2],15,718787259),a=d(a,l,g,c,f[h+9],21,-343485551),c=c+b>>>0,a=a+T>>>0,l=l+x>>>0,g=g+B>>>0}return n.endian([c,a,l,g])};i._ff=function(r,n,t,o,e,u,i){var f=r+(n&t|~n&o)+(e>>>0)+i;return(f<<u|f>>>32-u)+n},i._gg=function(r,n,t,o,e,u,i){var f=r+(n&o|t&~o)+(e>>>0)+i;return(f<<u|f>>>32-u)+n},i._hh=function(r,n,t,o,e,u,i){var f=r+(n^t^o)+(e>>>0)+i;return(f<<u|f>>>32-u)+n},i._ii=function(r,n,t,o,e,u,i){var f=r+(t^(n|~o))+(e>>>0)+i;return(f<<u|f>>>32-u)+n},i._blocksize=16,i._digestsize=16,r.exports=function(r,t){if(void 0===r||null===r)throw new Error("Illegal argument "+r);var o=n.wordsToBytes(i(r,t));return t&&t.asBytes?o:t&&t.asString?u.bytesToString(o):n.bytesToHex(o)}}()},function(r,n){!function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(r,n){return r<<n|r>>>32-n},rotr:function(r,n){return r<<32-n|r>>>n},endian:function(r){if(r.constructor==Number)return 16711935&t.rotl(r,8)|4278255360&t.rotl(r,24);for(var n=0;n<r.length;n++)r[n]=t.endian(r[n]);return r},randomBytes:function(r){for(var n=[];r>0;r--)n.push(Math.floor(256*Math.random()));return n},bytesToWords:function(r){for(var n=[],t=0,o=0;t<r.length;t++,o+=8)n[o>>>5]|=r[t]<<24-o%32;return n},wordsToBytes:function(r){for(var n=[],t=0;t<32*r.length;t+=8)n.push(r[t>>>5]>>>24-t%32&255);return n},bytesToHex:function(r){for(var n=[],t=0;t<r.length;t++)n.push((r[t]>>>4).toString(16)),n.push((15&r[t]).toString(16));return n.join("")},hexToBytes:function(r){for(var n=[],t=0;t<r.length;t+=2)n.push(parseInt(r.substr(t,2),16));return n},bytesToBase64:function(r){for(var t=[],o=0;o<r.length;o+=3)for(var e=r[o]<<16|r[o+1]<<8|r[o+2],u=0;u<4;u++)8*o+6*u<=8*r.length?t.push(n.charAt(e>>>6*(3-u)&63)):t.push("=");return t.join("")},base64ToBytes:function(r){r=r.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],o=0,e=0;o<r.length;e=++o%4)0!=e&&t.push((n.indexOf(r.charAt(o-1))&Math.pow(2,-2*e+8)-1)<<2*e|n.indexOf(r.charAt(o))>>>6-2*e);return t}};r.exports=t}()},function(r,n){function t(r){return!!r.constructor&&"function"==typeof r.constructor.isBuffer&&r.constructor.isBuffer(r)}function o(r){return"function"==typeof r.readFloatLE&&"function"==typeof r.slice&&t(r.slice(0,0))}
r.exports=function(r){return null!=r&&(t(r)||o(r)||!!r._isBuffer)}},function(r,n,t){r.exports=t(1)}]);;
(function($){$.fn.jqueryPincodeAutotab=function(options){var listOfElements=$(this);var settings=$.extend({prevElement:null,nextElement:null,onPasteRegexp:null,},options);return this.each(function(index,value){$(value).on("keydown",function(event){var move=0;switch(event.keyCode){case 48:case 96:$(this).val("0");move=1;event.preventDefault();break;case 49:case 97:$(this).val("1");move=1;event.preventDefault();break;case 50:case 98:$(this).val("2");move=1;event.preventDefault();break;case 51:case 99:$(this).val("3");move=1;event.preventDefault();break;case 52:case 100:$(this).val("4");move=1;event.preventDefault();break;case 53:case 101:$(this).val("5");move=1;event.preventDefault();break;case 54:case 102:$(this).val("6");move=1;event.preventDefault();break;case 55:case 103:$(this).val("7");move=1;event.preventDefault();break;case 56:case 104:$(this).val("8");move=1;event.preventDefault();break;case 57:case 105:$(this).val("9");move=1;event.preventDefault();break;case 8:case 46:$(this).val("");move=-1;event.preventDefault();break;case 37:move=-1;event.preventDefault();break;case 39:move=1;event.preventDefault();break;case 9:if(event.shiftKey){move=-1;}else{move=1;}
event.preventDefault();break;case 86:if(!(event.ctrlKey||event.metaKey)){event.preventDefault();}
break;case 13:case 16:case 17:case 91:break;case 229:var androidKeyCode=$(this).val();if($.isNumeric(androidKeyCode)){move=1;}
break;default:event.preventDefault();}
for(var i=0;i<listOfElements.length;i++){var prevElement;var nextElement;if(i-1>=0){prevElement=listOfElements[i-1];}
if(i+1<=listOfElements.length){nextElement=listOfElements[i+1];}
if(listOfElements[i]==this){switch(move){case 1:if(nextElement){$(nextElement).select();$(nextElement).focus();}else{if(settings.nextElement){settings.nextElement.select();settings.nextElement.focus();}}
break;case-1:if(prevElement){$(prevElement).select();$(prevElement).focus();}else{if(settings.prevElement){settings.prevElement.select();settings.prevElement.focus();}}
break;}}}});$(value).on("paste",function(event){event.preventDefault();var clipboardData=event.clipboardData||event.originalEvent.clipboardData||window.clipboardData;var pastedData=clipboardData.getData('text/plain');if(options.onPasteRegexp&&pastedData.match(options.onPasteRegexp)===null){return false}
for(var i=0;i<listOfElements.length;i++){var data=function(){return pastedData[i];}
$(listOfElements[i]).val(data);}
if(typeof options.onPasteCallback==='function'){options.onPasteCallback()}});});};}(jQuery));;
const BookComment=function(comment){this.id=$(comment).data('id')
this.object=$(comment).parent().data('object')
this.deleteComment=function()
{if(!confirm('Delete comment by\n'+
$(".comment__user",comment).text().replace(/\s+/g,' ')+'\n@'+$(".comment__date",comment).text().replace(/\s+/g,' ')+'?')){return}
deleteUrl={book:'/papi/comments/delete/'+this.id,booklist:'/papi/comments/delete/'+this.id,blog:'/papi/comments/delete/'+this.id,gratitude:'/papi/gratitudes/delete/'+this.id,}
const request=new Request(deleteUrl[this.object],{method:'DELETE',})
return new ZLibraryResponse(request).success(response=>$(comment).fadeOut().promise().then(element=>element.remove())).fetch()}
this.deleteAllComments=function($button){const $tabLink=$(".nav-tabs li.active a"),count=Number.parseInt($tabLink.text().replace(/[^\d]/g,'')),type=$tabLink.attr("href").slice(4).toLowerCase(),userId=$button.data("userid")||0
if(!Number.parseInt(count)){ZLibraryNotify().warning("Nothing to delete")
return}
if(!confirm('Delete all '+count+' items (type: '+type+')?')){return}
const request=new Request(`/papi/admin/user/${userId}/delete-user-comments`,{method:'DELETE',body:JSON.stringify({type:type})})
return new ZLibraryResponse(request).spinner($button).success(response=>{$(".tab-pane.active .comment").fadeOut().promise().then(element=>element.remove())
$tabLink.text($tabLink.text().replace(/\(\d+\)/,"(0)"))}).error(response=>new ZLibraryNotify().error(response.error)).fetch()}};
const BookTemporary=function(book){if(book){this.id=book.id
this.data=book}
this.uploadCover=(file,success)=>{if(!file){return}
const data=new FormData()
data.append('cover',file)
const spinner=new ZLibrarySpinner('iconCoverUpload')
const request=new Request('/papi/book-temporary/'+this.id+'/cover',{method:'POST',body:data})
return new ZLibraryResponse(request).spinner(spinner).success(success).fetch()}
this.save=(data,success)=>{const spinner=new ZLibrarySpinner('btnSubmitBook')
const request=new Request('/papi/book-temporary/'+this.id,{method:'PUT',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:data,})
return new ZLibraryResponse(request).spinner(spinner).success(success).fetch()}
this.setFromMeta=(success)=>{const request=new Request('/papi/book-temporary/'+this.id+'/set-from-meta')
return new ZLibraryResponse(request).success(success).fetch()}
this.confirm=(success,error)=>{const spinner=new ZLibrarySpinner('iconConfirm_'+this.id).color('#8ecd51')
const request=new Request('/papi/book-temporary/'+this.id+'/confirm')
return new ZLibraryResponse(request).spinner(spinner).success(success).error(error).fetch()}
this.delete=(success,error)=>{const request=new Request('/papi/book-temporary/'+this.id,{method:'DELETE',})
return new ZLibraryResponse(request).success(success).error(error).fetch()}
this.showModal=()=>{this.modal=new ZLibraryModal({url:'/layer/_modals/book_temporary_edit_dialog?id='+this.id,title:'Edit book',width:"100%",top:"-15px",styles:{'max-width':'1100px'},}).show()}
this.hideModal=()=>{$('#zlibrary-modal').modal('hide')}};
const TagsInput=function($el,user,bookId,availableTags){const tags=this
this.user=user
this.bookId=bookId
this.$el=$el
this.beforeItemAdd=function(event,options){tags.cancelDestroy=true
const tagName=event.item.toString()
const $tagsContainerInput=$(event.target).closest('.tags-container-input')
if(!isValidInputString(tagName)){tags.$el.tagsinput('remove',tagName)
return false}
const request=new Request('/papi/user/book/'+tags.bookId+'/tag',{method:'PUT',body:tagName,})
new ZLibraryResponse(request).success(function(){CurrentUser.addBookTagsInHtml(tagName)}).error(json=>{ZLibraryNotify({delay:8000}).error(json.error?json.error:i18next.t('Something went wrong'))
tags.$el.tagsinput('remove',tagName,{preventPost:true})}).fetch()
setTimeout(function(){$tagsContainerInput.find('.bootstrap-tagsinput input').val('')},1)}
this.itemAdded=function(event){const tagName=event.item.toString()
const $tagsContainerInput=$(event.target).closest('.tags-container-input')
const $lastTag=$tagsContainerInput.find('.bootstrap-tagsinput .tag:last')
if(!isValidInputString(tagName)){$lastTag.remove()
$tagsContainerInput.find('.bootstrap-tagsinput input').val('').focus()
new ZLibraryNotify().error(i18next.t('Invalid tag name'))
return false}
$lastTag.html(tagName+'<span data-role="remove"></span>')}
this.beforeItemRemove=function(event,options){tags.cancelDestroy=true
const request=new Request('/papi/user/book/'+tags.bookId+'/tag',{method:'DELETE',body:event.item,})
new ZLibraryResponse(request).success(function(){CurrentUser.removeBookTagsInHtml(event.item)}).fetch()}
this.clear=function(){tags.$el.tagsinput('removeAll')}
tags.$el.tagsinput({typeahead:{source:availableTags},maxChars:30,})
tags.$el.on('beforeItemAdd',this.beforeItemAdd)
tags.$el.on('beforeItemRemove',this.beforeItemRemove)
tags.$el.on('itemAdded',this.itemAdded)
tags.$el.closest('.tags-container-input').find('.bootstrap-tagsinput input').trigger('keydown')
$('.bootstrap-tagsinput input').on('input',function(){const length=$(this).val().length
if(length>1&&length<=5){$(this).css('width',(length*18)+'px')}else if(length>5){$(this).css('width',(length*12)+'px')}else{$(this).css('width','auto')}})
$('.bootstrap-tagsinput input').on('focusout',function(){const $that=$(this)
const $input=tags.$el.closest('.tags-container-input').find('.bootstrap-tagsinput input')
if(!$input.length){return}
if($input.val().length){$input.trigger('keypress').trigger('focusout')
return}
tags.cancelDestroy=false
setTimeout(function(){if(tags.cancelDestroy){return false}
const $tagsContainer=$that.closest('.bookRow').find('.tags-container')
const $tagsContainerInput=$that.closest('.tags-container-input')
$tagsContainer.find('span.label-info').remove()
$tagsContainer.prepend($tagsContainerInput.find('span.tag'))
$tagsContainerInput.addClass('hidden')
$tagsContainer.removeClass('hidden')
tags.$el.off('beforeItemAdd',this.beforeItemAdd)
tags.$el.off('beforeItemRemove',this.beforeItemRemove)
tags.$el.off('itemAdded',this.itemAdded)
tags.$el.tagsinput('destroy')
$('#savedBooksTagList').load(window.location.href+' #savedBooksTagList')},300)})};
const ZLibraryModal=function(options){options=options||{}
const defaults={element:null,url:null,width:null,top:null,title:null,formAction:null,formData:null,template:null,templateData:null,container:'zlibrary-modal',modalDialogClass:'',autoFocus:true,bodyPadding:null,footer:null,fullscreen:false,pretty:null,styles:null,staticBackdrop:false,centered:false,blockPreCallbackCleanup:false,}
options=$.extend({},defaults,options)
const $container=$('#'+options.container)
const $containerHeader=$container.find('.modal-header')
const $containerBody=$container.find('.modal-body')
const spinner=new ZLibrarySpinner($containerBody).color('#999').length(15).lines(12).width(4).radius(12)
if(options.staticBackdrop){$container.attr('data-keyboard',false).attr('data-backdrop','static')}
function show(){reset()
$container.trigger('show')
$container.modal('show')
if(options.centered){$container.css({display:'flex',alignItems:'center',justifyContent:'center',});}
window.dispatchEvent(new CustomEvent('modalOpened',{detail:{name:options.element}}))
$('.modal-backdrop').addClass(options.container+'-backdrop')
spinner.start()
$container.find('.modal-dialog').css('width','200px')
$containerBody.find('.modal-dialog').css('height','200px')
if(options.modalDialogClass){$container.find('.modal-dialog').addClass(options.modalDialogClass)}
if(options.bodyPadding){$containerBody.css('padding',options.bodyPadding)}
if(options.title){$containerHeader.removeClass('hidden')
$containerHeader.find('.modal-title').html(options.title)}
if(options.fullscreen){let vh=window.innerHeight*0.01;document.documentElement.style.setProperty('--vh',`${vh}px`);if(options.title&&options.footer){$containerBody.css('height','calc(calc(var(--vh, 1vh) * 100) - 55px - 69px)');}else if(options.title){$containerBody.css('height','calc(calc(var(--vh, 1vh) * 100) - 55px)');}else if(options.footer){$containerBody.css('height','calc(calc(var(--vh, 1vh) * 100) - 69px)');}}else{$containerBody.css('height','auto');}
if(options.pretty){$container.find('.modal-dialog').addClass('pretty-modal');}
if(options.styles){$container.find('.modal-dialog').css(options.styles)}
getModalContent().then(content=>{spinner.stop()
let width=''
const contentWidth=document.querySelector(".super-puper-main-container").clientWidth
if(typeof options.width=='number'){if(contentWidth*0.96>options.width){width=options.width}else if(contentWidth<=480){width='auto'}else if(contentWidth<=600){width='80%'}else{width='60%'}}else if(typeof options.width=='string'){width=options.width}else{width=(contentWidth<=768)?'auto':''}
if(options.top){$container.find('.modal-dialog').css('top',options.top);}
$container.find('.modal-dialog').css('width',width)
$containerBody.find('.modal-dialog').css('height','auto')
$containerBody.html(content);$container.trigger('contentAdded');if(options.footer){$container.find('.modal-content').append(options.footer);}
if(options.formData){$.each(options.formData,function(index,value){const $el=$containerBody.find('[name="'+index+'"]')
if($el.length===0){return}
switch($el.attr('type')){case"checkbox":$el.prop('checked',value);break;case"radio":$.each($el,function(index){$($el[index]).prop('checked',$($el[index]).val()==value);})
break;default:$el.val(value);break;}})}
if(!!options.afterRender&&typeof options.afterRender==='function'){setTimeout(()=>{if(!options.blockPreCallbackCleanup){$container.css('padding','0');if(!options.top){$container.find('.modal-dialog').css('top','auto')}}
options.afterRender();},150);}
if(options.formAction){$containerBody.find('form').attr('action',options.formAction)}
if(options.autoFocus&&$container.find('input, textarea').first()){setTimeout(function(){$container.find('input, textarea').first().focus()},500);}
setTimeout(()=>$container.trigger('shown'),505);}).catch(error=>{spinner.stop()
$container.find('.modal-dialog').css('height','auto')
$containerHeader.removeClass('hidden')
$containerHeader.find('.modal-title').html(i18next.t('Something went wrong'))
$container.modal('show')
$containerBody.html('<div class="modal-error">'+error.message+'</div>')})
return this}
function hide(){$container.modal('hide')
window.dispatchEvent(new CustomEvent('modalClosed',{detail:{name:options.element}}))
return this}
function formAction(formAction){options.formAction=formAction
return this}
function formData(data){options.formData=data
return this}
function formClear(){$.each($containerBody.find('input,select,textarea'),function(){$el=$(this);if($el.attr('type')=='checkbox'){$el.prop('checked',false)}else if($el.attr('type')=='radio'){}else{$el.val('')}})
return this}
function templateData(data){options.templateData=data
return this}
function title(title){options.title=title
return this}
function reset(){$container.find('.modal-dialog').css('width','')
$container.find('.modal-content').find('.modal-footer').remove()
$containerHeader.addClass('hidden')
$containerHeader.find('.modal-title').html('')
$containerBody.html('')}
function getModalContent(){if(options.url){return fetch(options.url).then(response=>{return response.text()})}else if(options.element){const $element=document.getElementById(options.element)
const sourceHtml=$element.innerHTML
if(!!options.removeSource){$element.remove();}
return new Promise(resolve=>resolve(sourceHtml))}else if(options.template){const html=options.template(options.templateData)
return new Promise(resolve=>resolve(html))}
throw new Error('"url", "element" or "template" option is required')}
this.show=show;this.hide=hide;this.title=title;this.formAction=formAction;this.formClear=formClear;this.formData=formData;this.templateData=templateData;};
const ZLibrarySearch={scope:'zlib-search',expires:1000*60*60*24*30,settingWraps:[],instZLibraryMultiselect:null,switchView:function(viewName){viewName=viewName||''
setCookie(ZLibrarySearch.scope+'View',viewName,ZLibrarySearch.makeExpires(viewName));document.location.reload();},makeExpires:function(value){return!!value?ZLibrarySearch.expires:-1;},saveSearchSettings:function(){if($('#advSearch .multiselect-input_err').length){new ZLibraryNotify().error(i18next.t('Incorrect filters'))
return false}
const settingStr=JSON.stringify(ZLibrarySearch.getSettings());setCookie(ZLibrarySearch.scope+'Settings',settingStr,ZLibrarySearch.makeExpires(settingStr));ZLibrarySearch.toggleIcons();},clearFilters:function(){ZLibrarySearch.blockToggleIcons=true;for(const el of ZLibrarySearch.settingWraps){const isCheckbox=el.$wrap.get(0).nodeName==='INPUT';if(isCheckbox){el.$wrap.prop('checked',false);}else{$('option',el.$wrap).each((idx,item)=>{$(item).attr('selected',false);});el.$wrap.val('');el.$wrap.change();}
el.$wrap.closest('.multiselect-box-wrap').find('.multiselect-input').removeClass('multiselect-input_err');}
ZLibrarySearch.blockToggleIcons=false;ZLibrarySearch.saveSearchSettings();ZLibrarySearch.toggleIcons();},getSettings:function(){let settings={length:0};for(const el of ZLibrarySearch.settingWraps){const isCheckbox=el.$wrap.get(0).nodeName==='INPUT';const isSingleSelect=el.$wrap.attr('multiple')!='multiple';let selOpt=null;let tmpArr=[];if(isCheckbox){if(el.$wrap.prop('checked')){selOpt=el.$wrap.val();}}else{if(isSingleSelect){$('option',el.$wrap).each((idx,item)=>{if($(item).attr('selected')){selOpt=el.$wrap.val();return false;}});}else{$('option',el.$wrap).each((idx,item)=>{if($(item).attr('selected')){tmpArr.push($(item).val());}});if(tmpArr.length){selOpt=tmpArr;}}
const actionsTmpArr=[]
$('optgroup[label*="actions"] > option',el.$wrap).each((idx,item)=>{if($(item).attr('selected')){actionsTmpArr.push($(item).val())
tmpArr.splice($(item).val(),1)}
if(actionsTmpArr.length){settings['actions']=settings['actions']?settings['actions'].concat(actionsTmpArr):actionsTmpArr}})}
if(selOpt){settings[el.name]=selOpt;++settings.length;}}
return settings;},getSettingsFromCook:function(){let settingsStr=getCookie(ZLibrarySearch.scope+'Settings');let settings={length:0};if(settingsStr){try{settings=JSON.parse(settingsStr);}catch(e){console.log(e);}}
return settings;},isSearchSettings:function(){const currentSettings=ZLibrarySearch.getSettings();return currentSettings.length>0;},isSearchSettingsInCooke:function(){const settings=ZLibrarySearch.getSettingsFromCook();return settings.length>0;},isDiffSettings:function(){const currentSettings=ZLibrarySearch.getSettings();const cookSettings=ZLibrarySearch.getSettingsFromCook();if(currentSettings.length!==cookSettings.length){return true;}
delete cookSettings.length;for(const idx in cookSettings){if(!currentSettings[idx]){return true;}
if(Array.isArray(cookSettings[idx])){if(cookSettings[idx].length!==currentSettings[idx].length){return true;}
for(const cookValue of cookSettings[idx]){let isDiff=true;for(const currentValue of currentSettings[idx]){if(cookValue===currentValue){isDiff=false;}}
if(isDiff){return true;}}}
else if(cookSettings[idx]!==currentSettings[idx]){return true;}}
return false;},toggleIcons:()=>{if(!!ZLibrarySearch.blockToggleIcons){return false;}
const $iconClearWrap=$('.clear-search-settings');const $iconSaveWrap=$('.saving-search-settings');const $iconSaveBody=$('.svg__body',$iconSaveWrap);const $iconSaveCheckMark=$('.svg__body-check-mark',$iconSaveWrap);const $iconSaveBorder=$('.svg__border',$iconSaveWrap);if(!ZLibrarySearch.isSearchSettings()&&!ZLibrarySearch.isSearchSettingsInCooke()){$iconSaveWrap.addClass('hidden');$iconClearWrap.addClass('hidden');}
else if(ZLibrarySearch.isDiffSettings()){$iconSaveWrap.removeClass('saving-search-settings__blocked hidden').attr('title',$iconSaveWrap.data('title_save'));$iconSaveBody.addClass('svg_active');$iconSaveCheckMark.hide();$iconClearWrap.removeClass('hidden');}
else{$iconSaveWrap.removeClass('hidden').addClass('saving-search-settings__blocked').attr('title',$iconSaveWrap.data('title_saved'));$iconSaveBody.removeClass('svg_active');$iconSaveCheckMark.show();$iconClearWrap.removeClass('hidden');}},initWraps:function(){const multiselectWrapClass='.'+ZLibrarySearch.instZLibraryMultiselect.getGeneralWrapClass();const selectClass='.'+ZLibrarySearch.instZLibraryMultiselect.getTargetSelectClass();const settings=[{name:'e',$wrap:$('input[name="e"]')},{name:'yearFrom',$wrap:$('#wrapYearFrom').closest(multiselectWrapClass).find(selectClass)},{name:'yearTo',$wrap:$('#wrapYearTo').closest(multiselectWrapClass).find(selectClass)},{name:'languages',$wrap:$('#wrapLang').closest(multiselectWrapClass).find(selectClass)},{name:'extensions',$wrap:$('#wrapExt').closest(multiselectWrapClass).find(selectClass)}];for(const el of settings){if(el.$wrap.length){ZLibrarySearch.settingWraps.push(el);}}},init:function(){$(function(){ZLibrarySearch.instZLibraryMultiselect=ZLibraryMultiselect({onlyStaticBehavior:true});ZLibrarySearch.initWraps();ZLibrarySearch.toggleIcons();const selectClass='.'+ZLibrarySearch.instZLibraryMultiselect.getTargetSelectClass();$('input[name="e"], '+selectClass).on('change',function(){let query=$('#searchFieldx').val();if($(this).is(':checked')){query='"'+query+'"';}else{if(query.slice(0,1)=='"'&&query.slice(-1)=='"'){query=query.slice(1);query=query.slice(0,-1);}}
$('#searchFieldx').val(query);ZLibrarySearch.toggleIcons();});$('#searchFieldx').on('change input',function(){let query=$('#searchFieldx').val();if(query.slice(0,1)=='"'&&query.slice(-1)=='"'){$('input[name="e"], '+selectClass).prop('checked',true);}else{$('input[name="e"], '+selectClass).prop('checked',false);}
ZLibrarySearch.toggleIcons();});});},};;
const ZLibraryConfirm=function(title,message,positiveBtnText,negativeBtnText,primaryButton){'use strict'
this.title=title
this.message=message
this.positiveBtnText=positiveBtnText||i18next.t('Yes')
this.negativeBtnText=negativeBtnText||i18next.t('Cancel')
const primarityClasses={negativeBtn:primaryButton!=='positiveBtn'?'primary':'',positiveBtn:primaryButton==='positiveBtn'?'primary':'',}
this.confirmContent=$(`
        <div class="zlibrary-confirm-overlay">
            <div class="zlibrary-confirm-container">
                <div class="zc-title">`+this.title+`</div>
                <div class="zc-message">`+this.message+`</div>
                <div class="zc-buttons">
                    <button class="zc-negative-btn `+primarityClasses.negativeBtn+`">`+this.negativeBtnText+`</button>
                    <button class="zc-positive-btn `+primarityClasses.positiveBtn+`">`+this.positiveBtnText+`</button>
                </div>
            </div>
        </div>
    `)
this.callback=false
this.positiveCallback=function(){}
this.negativeCallback=function(){}
this.setPrimaryOnPositiveBtn=()=>{this.confirmContent.find('.zc-negative-btn').removeClass('primary')
this.confirmContent.find('.zc-positive-btn').addClass('primary')
return this}
this.setPrimaryOnNegativeBtn=()=>{this.confirmContent.find('.zc-positive-btn').removeClass('primary')
this.confirmContent.find('.zc-negative-btn').addClass('primary')
return this}
this.destroy=()=>{this.confirmContent.fadeOut(150,()=>{this.confirmContent.remove()})
this.unbindKeyboardEvents()}
this.bindKeyboardEvents=()=>{const that=this
$(document).on('keydown.ZLibraryConfirm',function(){return false})
$(document).on('keyup.ZLibraryConfirm',function(e){switch(e.which){case 9:const $primaryBtn=that.confirmContent.find('button.primary')
const $nextBtn=$primaryBtn.next('button').length?$primaryBtn.next('button'):that.confirmContent.find('.zc-buttons button:first')
$primaryBtn.removeClass('primary')
$nextBtn.addClass('primary')
break
case 13:that.confirmContent.find('button.primary').trigger('click')
break
case 27:that.destroy()
break}})}
this.unbindKeyboardEvents=()=>{$(document).off('keydown.ZLibraryConfirm keyup.ZLibraryConfirm')}
this.show=async function(){const that=this
if(!this.title.length||!this.message.length){return false}
this.bindKeyboardEvents()
const promise=new Promise((complete,failed)=>{that.confirmContent.find('.zc-positive-btn').on('click',()=>{that.destroy()
complete(true)})
that.confirmContent.find('.zc-negative-btn').on('click',()=>{that.destroy()
complete(false)})
that.confirmContent.on('click',(e)=>{if($(e.target).hasClass('zlibrary-confirm-overlay')){that.destroy()
complete(false)}})
$('body').append(that.confirmContent.fadeIn(150))})
if(that.callback){promise.then((result)=>{result?that.positiveCallback():that.negativeCallback()})}
return promise}}
ZLibraryConfirm.prototype=function(){function positive(callback){this.positiveCallback=callback
this.callback=true
return this}
function negative(callback){this.negativeCallback=callback
this.callback=true
return this}
return{positive:positive,negative:negative}}();"use strict";class ISBN{static valid10(isbn){isbn=ISBN.clear(isbn);if(isbn.length==10){let control=0;for(let i in[...isbn])
control+=isbn[i].toLowerCase()=="x"?(10-parseInt(i))*10:(10-parseInt(i))*parseInt(isbn[i]);return control%11==0;}
return false;}
static valid13(isbn){isbn=ISBN.clear(isbn);if(isbn.length==13){let control=0;for(let i in[...isbn])
control+=parseInt(i)%2==0?parseInt(isbn[i]):parseInt(isbn[i])*3;return control%10==0;}
return false;}}
ISBN.clear_isbn_pattern=/[^0-9x]/gi;ISBN.isbn10_pattern=/^\d{9}[0-9x]$/i;ISBN.isbn13_pattern=/^97[89]\d{10}$/;ISBN.clear=(isbn)=>isbn.replace(ISBN.clear_isbn_pattern,"");ISBN.check=(isbn)=>ISBN.isbn10_pattern.test(ISBN.clear(isbn))||ISBN.isbn13_pattern.test(ISBN.clear(isbn));ISBN.valid=(isbn)=>(ISBN.check(isbn)?ISBN.valid10(isbn)||ISBN.valid13(isbn):false);;
const ZLibraryContextMenu=function(options){options=options||{}
const defaults={list:null,x:0,y:0}
options={...defaults,...options}
const contextMenus=document.getElementsByClassName("zlib-context-menu");while(contextMenus.length>0){contextMenus[0].parentNode.removeChild(contextMenus[0]);}
if(!options.list){return}
if(options.node){options.node.classList.add('context-menu-keep-visible')}
const insertElement=function(element){let node=document.createElement("div");switch(element.type){case"fetch":node.innerHTML='<div class="z-skeleton"><img src="/img/logo.zlibrary.png"/></div>';element.load(node)
break;case"component":node.innerHTML=element.html;break;}
if(window.innerWidth>690){node.addEventListener('mouseleave',(e)=>{e.target.parentNode.parentNode.parentNode.classList.remove('opened')})}
return node}
const toggleOpen=function(node,mode){const root=node.closest('.zlib-context-menu-wrap')
root.classList.add('swap');if(!node.classList.contains('opened')||mode==='open'){setTimeout(()=>{node.classList.add('opened');root.classList.add('opened');root.classList.remove('swap');},200)}else{setTimeout(()=>{node.classList.remove('opened');root.classList.remove('opened');root.classList.remove('swap');},200)}}
const insertContext=function(list){let nodesWrap=document.createElement("div");let nodes=[];nodesWrap.classList.add("zlib-context-menu-wrap");list.filter(element=>(element!==null&&element.text!==null)).forEach(element=>{let node=document.createElement(element.link?"a":"div");node.classList.add("zlib-context-element");if(element.tooltip){node.setAttribute('data-tooltip',element.tooltip);node.addEventListener('mouseenter',ZLibrary.showTooltip);}
if(element.class)node.classList.add(element.class);if(element.type){node.appendChild(insertElement(element));node.classList.add("zlib-context-"+element.type);}else if(element.list){node.innerHTML=`<div class="zlib-context-line"><div class="icon"><i class="${element.icon}"></i></div><div>${element.text}</div><div class="zlib-content-arrow zlibicon-angle-bracket-right"></div></div>`;node.appendChild(insertContext(element.list));node.querySelector('.zlib-context-line').addEventListener('click',()=>{toggleOpen(node)});}else if(element.premium){node.classList.add('premium')
node.innerHTML=`<div class="zlib-context-line"><div class="icon"><i class="${element.icon}"></i></div><div>${element.text}</div><div class="clear"></div><div class="premium-modal-trigger">Premium</div></div>`;node.addEventListener("click",close);}else{node.innerHTML=`<div class="zlib-context-line"><div class="icon"><i class="${element.icon}"></i></div><div>${element.text}</div></div>`;element.link&&(node.href=element.link);typeof element.onClick=="function"&&node.addEventListener("click",element.onClick);node.addEventListener("click",close);}
nodes.push(node);});nodes.map(node=>{nodesWrap.appendChild(node)});return nodesWrap}
let base=document.createElement("div");let back=document.createElement("div");back.classList.add("zlib-context-menu-close");const removeContentMenu=(e)=>{if(e.target!==base&&!base.contains(e.target)||e.type!=='click'||e.target.classList.contains('zlib-context-menu-close')){close()}}
const close=()=>{base.classList.add("leaving")
document.removeEventListener("click",removeContentMenu);document.removeEventListener("contextmenu",removeContentMenu);back.removeEventListener("click",removeContentMenu);options.node?.classList.remove('context-menu-keep-visible')
setTimeout(()=>{try{document.body.removeChild(base);}catch{}},300)}
base.classList.add("zlib-context-menu");base.style.left=options.x+'px';base.style.top=(options.y+10)+'px';base.appendChild(back);base.appendChild(insertContext(options.list));document.body.appendChild(base);if(base.offsetWidth+options.x>window.innerWidth){base.style.left=(window.innerWidth-base.offsetWidth-20)+'px'}
if(window.innerWidth-base.offsetWidth-options.x<300){base.classList.add('right');}
setTimeout(()=>{document.addEventListener("click",removeContentMenu);document.addEventListener("contextmenu",removeContentMenu);back.addEventListener("click",removeContentMenu);})};
function ProxyChecker(proxy){this.refreshAfter=60*60;this.scope='proxies';this.pathToTest="/p/index.png";this.testProxy=function(proxy)
{let self=this;$.ajax({url:'https://'+proxy+this.pathToTest,type:'GET',success:function(a,g,resp){if(resp.status===200&&resp.responseText.length)
{self.setStatus(proxy,true);}else{self.setStatus(proxy,false);}},error:function(){self.setStatus(proxy,false);}});};this.setStatus=function(proxy,status){let currentStates=this.getAllStates();currentStates[proxy]={status:status,lastUpdate:Math.floor(new Date().getTime()/1000)};localStorage.setItem(this.scope+'States',JSON.stringify(currentStates));this.syncCookies();};this.syncCookies=function(){let notWorkingProxies=[];$.each(this.getAllStates(),function(k,v){v.status===false?notWorkingProxies.push(k):null;});if(notWorkingProxies.length)
{setCookie(this.scope+'NotWorking',notWorkingProxies.join(),this.refreshAfter*1000*2);}else{setCookie(this.scope+'NotWorking',notWorkingProxies.join(),-1);}};this.getStatus=function(proxy){let currentStates=this.getAllStates();if(currentStates[proxy])
{return currentStates[proxy];}else{return{};}};this.getAllStates=function()
{if(!localStorage.getItem(this.scope+'States')){return{};}
return JSON.parse(localStorage.getItem(this.scope+'States'));};this.clearExcept=function(proxies)
{let self=this;currentStates=self.getAllStates();$.each(currentStates,function(k,v){if(proxies.indexOf(k)===-1)
{delete currentStates[k];}});localStorage.setItem(this.scope+'States',JSON.stringify(currentStates));};this.refreshAll=function()
{let self=this;let currentStates=this.getAllStates();let currentTimestamp=Math.floor(new Date().getTime()/1000);$.each(currentStates,function(proxy,v){if(currentTimestamp-v.lastUpdate>self.refreshAfter)
{self.testProxy(proxy);}});};this.refresh=function(proxy)
{let self=this;let currentTimestamp=Math.floor(new Date().getTime()/1000);let currentState=this.getStatus(proxy);if(currentState&&currentState.lastUpdate&&(currentTimestamp-currentState.lastUpdate<self.refreshAfter))
{}else{this.testProxy(proxy);}};};
const DomainsCheckerTool=function(options={}){const that=this
const defaults={timeout:15000,endpoint:'/p/index.php',}
options=$.extend({},defaults,options||{})
this.findFirstAvailableDomain=async function(domains){return new Promise(function(resolve){domains=normalizeDomains(domains)
let stop=false
let counter=0
for(const domainObject of domains){if(stop){return}
that.checkDomain(domainObject.name).then(function(result){counter=counter+1
if(stop){return}
if(result!==false){stop=true
resolve(domainObject.name)}else if(counter>=domains.length){resolve(false)}})}})}
this.findFirstAvailablePriorityDomain=async function(domains){return new Promise(function(resolve){domains=sortByRank(normalizeDomains(domains))
for(const domainObject of domains){that.checkDomain(domainObject.name).then(function(result){domainObject.status=result})}
let currentIndex=0
const observer=function(){const currentDomain=domains[currentIndex]
if(!$.isPlainObject(currentDomain)){resolve(false)}else if(currentDomain.status===true){resolve(currentDomain.name)}else if(currentDomain.status===false){currentIndex=currentIndex+1
observer()}else{setTimeout(observer,500)}}
observer()})}
this.checkDomain=async function(domain){return new Promise(function(resolve){if(typeof domain!=='string'){throw Error('Argument 1 must be of the type string, '+typeof domain+' given')}
$.ajax({url:makeEndpoint(domain),timeout:options.timeout,success:function(data,g,resp){resolve(resp.status===200&&resp.responseText.length>0)},error:function(data,g,resp){resolve(false)},})})}
this.checkInternetConnection=async function(){return new Promise(function(resolve){if(window.navigator&&window.navigator.onLine===false){return resolve(false)}
const url='https://www.iana.org'
function callback(hasConnection){resolve(hasConnection)}
const timer=setTimeout(function(){callback(false)},10000)
const img=document.createElement("img")
img.onload=function(){clearTimeout(timer)
callback(true)}
img.onerror=function(){clearTimeout(timer)
callback(false)}
img.src=url+"/favicon.ico?_="+(new Date().getTime())})}
function makeEndpoint(domain){return new URL(protocolify(domain)).origin+options.endpoint+'?v='+new Date().getTime()}
function protocolify(domain){if(domain.indexOf('http')===0){return domain}
return`https://${domain}`}
function normalizeDomains(domains){if(!$.isArray(domains)){throw Error('Invalid domains list')}
let list=[]
for(let domain of domains){if(typeof domain==='string'){list.push({name:domain})}else if($.isPlainObject(domain)&&typeof domain.name==='string'){list.push(domain)}else{throw Error('Invalid domains list')}}
return list}
function sortByRank(domains){let hasRank=false
for(let domain of domains){if(typeof domain.rank==='number'){hasRank=true}else{domain.rank=1}}
if(!hasRank){return domains}
return domains.sort(function(a,b){return b.rank-a.rank})}}
const DomainsCheckerBasic=function(options={}){const defaults={region:Config.BRegion||'unknown',country:Config.Country||'unknown',mode:'unknown',source:'unknown'}
options=$.extend({},defaults,options||{})
this.findAvailableDomain=async function(domains){return new Promise(function(resolve){const Checker=new DomainsCheckerTool()
Checker.findFirstAvailablePriorityDomain(domains).then(function(domain){if(domain){return resolve({domain:domain})}
Checker.checkInternetConnection().then(function(hasConnection){if(hasConnection){noDomainAvailableMetric()}
const logData={controlDomainAvailable:hasConnection,country:options.country,domains:domains,source:options.source,}
noDomainAvailableLog(logData).then(function(result){resolve({errorCode:result.code})})})})})}
function noDomainAvailableMetric(){$.RPC('Metric::rpcEvent',{name:'noDomainAvailable',value:1,tags:{mode:options.mode,region:options.region,country:options.country}})}
async function noDomainAvailableLog(data){return new Promise(function(resolve){new ZLibraryResponse('/papi/user/no-domain-available-found-log',data).success(function(result){return resolve(result)}).fetch()})}};
const Spelling=function(){this.modalConteinerID='zlibrary-modal-styled';this.modalElementID='spelling_modal_windows';this.runOnKeys=function(callback){document.addEventListener('keydown',event=>{const $target=$(event.target)
if($target.hasClass('modal')||$target.prop('tagName')=='FORM'||$target.closest('.modal, form').length){return}
if(event.code==='Enter'&&event.ctrlKey){callback();}});};this.runSelectText=()=>{const selectText=window.getSelection().toString().trim();if(!selectText.length){return;}
const elementSelectText=window.getSelection().anchorNode.parentElement;window.getSelection().empty();if(!CurrentUser.isAuth()){let isLoginForm=$(elementSelectText).closest('.singlelogin');if(!isLoginForm.length)CurrentUser.showAuthPopup('login',i18next.t('After authorization, you will be able to use this function'));return false;}
let isSpellingParrent=$(elementSelectText).closest('[data-spelling]');if(!(isSpellingParrent.length||$(elementSelectText).hasClass('property_label'))){let isBookParrent=$(elementSelectText).closest('[data-spelling-suggest]');if(isBookParrent.length){let suggestBookId=isBookParrent.attr('data-book_id');if(suggestBookId){const CurrentBook=new Book({id:suggestBookId});CurrentBook.suggestModal();return;}}
let isRequestParrent=$(elementSelectText).closest('[data-no-spelling]');if(isRequestParrent.length){return;}}
this.renderModalElement(selectText);this.reportModal();};this.reportModal=()=>{const $modalDialog=$('#'+this.modalConteinerID+' .modal-dialog')
this.modal=new ZLibraryModal({container:this.modalConteinerID,element:this.modalElementID,title:i18next.t('Report about the spelling error'),width:600,removeSource:true,afterRender:function(){$(document).on('shown.bs.modal',function(){$('#descriptionError').focus()
const top=parseInt(window.innerHeight/2-$modalDialog.height()/2-30)
$modalDialog.animate({top:(top>0?top:0)+'px',},{queue:false,duration:500}).animate({opacity:1},{queue:false,duration:300})})},})
$modalDialog.css('opacity',0)
this.modal.show()}
this.submitError=(data)=>{const spinner=new ZLibrarySpinner('spellingFormSubmit')
const request=new Request('/papi/spelling/set',{method:'POST',body:data,});return new ZLibraryResponse(request).spinner(spinner).success(response=>{ZLibraryNotify().info(i18next.t('Thank you for reporting a problem!')+'<br>'+
i18next.t('We will check this page soon'))}).fetch()}
this.renderModalElement=(selectText)=>{$('#'+this.modalElementID).remove();const self=this;const $modalElement=$('<div id="'+this.modalElementID+'" class="hidden">');$modalElement.append('<form role="form">'+'<input type="hidden" name="text" value="'+selectText+'">'+'<input type="hidden" name="url" value="'+document.location.href+'">'+'<div class="spelling-selected-title">'+
i18next.t('Error text:',{nsSeparator:false,keySeparator:false})+'&nbsp;<span class="spelling-selected-text">'+selectText+'</span>'+'</div>'+'<div class="spelling-description-title"><span style="color: red;">*</span>'+i18next.t('Correct the error or suggest a solution')+'</div>'+'<div class="spelling-description-text">'+'<textarea class="form-control" id="descriptionError"></textarea>'+'</div>'+'</form>'+'<div class="modal-footer">'+'<button class="btn-cancel">'+i18next.t('Cancel')+'</button>'+'<button type="submit" class="btn-primary" disabled id="spellingFormSubmit">'+i18next.t('Submit')+'</button>'+'</div>');$('body').append($modalElement).on("click.spelling",'#spellingFormSubmit',function(event){event.preventDefault();if(!$('#descriptionError').val().trim().length){ZLibraryNotify().error(i18next.t('Fill in the fields marked with an *.'))
return false;}
const formData=$('form',$modalElement).serialize()+"&description="+encodeURI($('#descriptionError').val());self.submitError(formData);self.modal.hide();$("body").off(".spelling");}).on("click.spelling",'.btn-cancel',function(event){self.modal.hide();}).on('keyup.spelling change.spelling','#descriptionError',function(){$('#spellingFormSubmit').prop('disabled',!$(this).val().trim().length)})};this.runOnKeys(this.runSelectText);}
new Spelling();;
const AuthForm=(function(){const cache=new WeakMap();const defaultOptions={isXhr:true,modal:null,};const validationErrorClassName='validation-error';function AuthForm(form){const _this=this
if(!(this instanceof AuthForm)){throw new TypeError('AuthForm constructor cannot be invoked without \'new\'');}
if(!jQuery){throw new Error('This object depends on jQuery library.');}
if(!form||!(form instanceof HTMLFormElement)){throw new TypeError('First argument must be an instance of HTMLFormElement.');}
if(cache.has(form)){return cache.get(form);}
cache.set(form,this);this.options=$.extend({},defaultOptions);this.$form=$(form);this.url=this.$form.attr('action');this.action=this.$form.data('action');this.$target=$('iframe[name='+this.$form.attr('target')+']');this.$interactiveElements=this.$form.find('input:not([type=hidden]), textarea, select, button').not('[disabled]');this.$submitButton=this.$interactiveElements.filter('[type="submit"]');this.$validationFields=this.$form.find('.validation-field');this.$messageElement=this.$form.find('.form-error');this.spinner=new ZLibrarySpinner(this.$submitButton);this.$form.on('submit.auth',submitHandler.bind(null,this));this.$form.on('validation.error',function(e,data){data=data||{}
validationErrors.show(_this,data.message,data.fields)});const $passwordButtons=this.$form.find('.btn-show-password, .btn-hide-password');const $passwordField=this.$interactiveElements.filter('.form-control-password');$passwordButtons.off('click.togglePasswordMode').on('click.togglePasswordMode',togglePasswordMode.bind(null,$passwordButtons,$passwordField));}
var proto=AuthForm.prototype;proto.useXhr=function useXhr(state){this.options.isXhr=!!state;return this;};proto.setModal=function modal(modalInstance){if(!(modalInstance instanceof ZLibraryModal)){throw new TypeError('Modal object must be an instance of ZLibraryModal');}
this.options.modal=modalInstance;return this;};proto.block=function block(){this.spinner.start();setTimeout(()=>{this.$interactiveElements.prop('disabled',true);},0);return this;}
proto.unblock=function unblock(){this.spinner.stop();this.$interactiveElements.prop('disabled',false);return this;}
proto.getData=function getData(){return this.$form.serializeArray().reduce(function(obj,item){obj[item.name]=item.value;return obj;},{isModal:this.options.isXhr});};proto.submit=function(){this.$form.trigger('submit.auth');return this;};function submitHandler(_this,e,data){data=data||{}
if(_this.action==='registration'&&data.forced!==true){return}
if(_this.action==='passwordrecovery'&&data.forced!==true){return}
_this.block()
validationErrors.hide(_this)
if(!_this.options.isXhr){_this.$target.one('load.auth',function(){_this.unblock();});return true;}
e.preventDefault()
sendRequest(_this);return false;}
const validationErrors={show:function(_this,message,fields){const isRegistration=_this.action==='registration'
const isPasswordRecovery=_this.action==='passwordrecovery'
let isInvalidCode=false
if(typeof fields==='object'){for(let i=0,c=fields.length;i<c;i++){if((isRegistration||isPasswordRecovery)&&fields[i]==='code'){$(document).trigger('zv.modal.invalidCode')
isInvalidCode=true}
_this.$validationFields.filter('[name="'+fields[i]+'"]').addClass(validationErrorClassName);}}
if(typeof message==='string'&&!isInvalidCode){if(_this.$messageElement.length&&_this.$messageElement.is(':visible')){_this.$messageElement.html(message);}else{new ZLibraryNotify().error(message);}}},hide:function(_this){_this.$validationFields.removeClass(validationErrorClassName);_this.$messageElement.text('');}}
function showDomainError(errorText){$('.well').hide()
$('.well.no-available-domains .errorCode').removeClass('hidden').find('.val').text(errorText)
$('.well.no-available-domains').show()}
function sendRequest(_this){const formData=_this.getData()
return $.RPC(_this.action,formData).done(function(result){const response=result.response;if(typeof response==='object'&&response!==null){if(response.validationError){_this.unblock();validationErrors.show(_this,response.message,response.fields)
if(_this.action==='registration'){$(document).trigger('zv.modal.onFormResponse')}
return;}
const params=new URLSearchParams(window.location.search)
if(params.get('redirectService')==='reader'){const readerURL=new URL(params.get('redirectUrl'))
new ZLibraryResponse(`/papi/reader/redirect-info/${params.get('book_sha256')}`).success(({result})=>{if(readerURL.origin===result.domain){readerURL.searchParams.set('user_id',response.user_id);readerURL.searchParams.set('user_key',response.user_key);readerURL.searchParams.set('download_location',result.download_location);redirectWithCounting('auth',readerURL.toString());}else showDomainError(result.errorCode);}).error((error)=>void showDomainError(error.errorCode?error.errorCode:'Something went wrong')).fetch()
return}
if(_this.action==='passwordrecovery'){if(response.redirectUrl)window.location=response.redirectUrl
return}
if(_this.action==='login'&&typeof response.priorityRedirectUrl==='string'){redirectWithCounting('auth',response.priorityRedirectUrl)
return}
if(_this.action==='registration'&&typeof response.forceRedirection==='string'){window.location.href=response.forceRedirection
return}
if(_this.action==='login'||_this.action==='registration'){const selectedMode=formData['site_mode']||'books'
$('.well').hide()
if($('.login-success').data('modal')){$('#auth_modal_registration > div').hide()
$('#auth_modal_registration > form').hide()
const link=$('#auth_modal_login input[name="redirectUrl"]').val()
$('.login-success a.link').prop("href",link||window.location.href)}
$('.login-success').show()
if(window.unreliableMail!==undefined&&window.unreliableMail.indexOf(formData['email'].split("@")[1])!=-1){$(".account-confirm-email").removeClass("hidden")}
new DomainsCheckerBasic({mode:selectedMode,source:'auth-form'}).findAvailableDomain(response.regularDomains).then(function(result){if(result.domain){redirectWithCounting('auth','//'+result.domain+response.params)}else showDomainError(result.errorCode);})
return}}
if(_this.action==='passwordrecovery'){$('#auth_modal_passwordrecovery').hide();$('#auth_modal_passwordrecovery_sended').show();return;}
_this.options.modal&&_this.options.modal.hide();setTimeout(function(){window.location.reload();},300);}).fail(function(a,b){_this.unblock();var message=i18next.t('Something went wrong');if(b&&b.errors){message=b.errors.message();}
new ZLibraryNotify().error(message);});};function togglePasswordMode($passwordButtons,$passwordField){$passwordButtons.toggleClass('hidden');$passwordField.attr('type',$passwordField.attr('type')==='password'?'text':'password');}
return AuthForm;})();;
var Mailcheck={domainThreshold:2,secondLevelThreshold:2,topLevelThreshold:2,defaultDomains:['msn.com','bellsouth.net','telus.net','comcast.net','optusnet.com.au','earthlink.net','qq.com','sky.com','icloud.com','mac.com','sympatico.ca','googlemail.com','att.net','xtra.co.nz','web.de','cox.net','gmail.com','ymail.com','aim.com','rogers.com','verizon.net','rocketmail.com','google.com','optonline.net','sbcglobal.net','aol.com','me.com','btinternet.com','charter.net','shaw.ca','163.com','126.com','yandex.ru','yopmail.com','looks.wang','foxmail.com','libero.it','proton.me','sharklasers.com','sosoushu.com','web.de','naver.com','freemybooks.info','vusra.com','ymail.com','gmx.de','wp.pl'],defaultSecondLevelDomains:["yahoo","hotmail","mail","live","outlook","gmx"],defaultTopLevelDomains:["com","com.au","com.tw","ca","co.nz","co.uk","de","fr","it","ru","net","org","edu","gov","jp","nl","kr","se","eu","ie","co.il","us","at","be","dk","hk","es","gr","ch","no","cz","in","net","net.au","info","biz","mil","co.jp","sg","hu","uk"],defaultBlockedDomains:[],run:function(opts){opts.domains=opts.domains||Mailcheck.defaultDomains;opts.secondLevelDomains=opts.secondLevelDomains||Mailcheck.defaultSecondLevelDomains;opts.topLevelDomains=opts.topLevelDomains||Mailcheck.defaultTopLevelDomains;opts.blockedDomains=opts.blockedDomains||Mailcheck.defaultBlockedDomains;opts.distanceFunction=opts.distanceFunction||Mailcheck.sift4Distance;var defaultCallback=function(result){return result;};var suggestedCallback=opts.suggested||defaultCallback;var emptyCallback=opts.empty||defaultCallback;var result=Mailcheck.suggest(Mailcheck.encodeEmail(opts.email),opts.domains,opts.secondLevelDomains,opts.topLevelDomains,opts.distanceFunction,opts.blockedDomains);return result?suggestedCallback(result):emptyCallback();},suggest:function(email,domains,secondLevelDomains,topLevelDomains,distanceFunction,blockedDomains){email=email.toLowerCase();var emailParts=this.splitEmail(email);if(blockedDomains){if(blockedDomains.indexOf(emailParts.secondLevelDomain)!==-1){return false;}}
if(secondLevelDomains&&topLevelDomains){if(secondLevelDomains.indexOf(emailParts.secondLevelDomain)!==-1&&topLevelDomains.indexOf(emailParts.topLevelDomain)!==-1){return false;}}
var closestDomain=this.findClosestDomain(emailParts.domain,domains,distanceFunction,this.domainThreshold);if(closestDomain){if(closestDomain==emailParts.domain){return false;}else{return{address:emailParts.address,domain:closestDomain,full:emailParts.address+"@"+closestDomain};}}
var closestSecondLevelDomain=this.findClosestDomain(emailParts.secondLevelDomain,secondLevelDomains,distanceFunction,this.secondLevelThreshold);var closestTopLevelDomain=this.findClosestDomain(emailParts.topLevelDomain,topLevelDomains,distanceFunction,this.topLevelThreshold);if(emailParts.domain){closestDomain=emailParts.domain;var rtrn=false;if(closestSecondLevelDomain&&closestSecondLevelDomain!=emailParts.secondLevelDomain){closestDomain=closestDomain.replace(emailParts.secondLevelDomain,closestSecondLevelDomain);rtrn=true;}
if(closestTopLevelDomain&&closestTopLevelDomain!=emailParts.topLevelDomain&&emailParts.secondLevelDomain!==''){closestDomain=closestDomain.replace(new RegExp(emailParts.topLevelDomain+"$"),closestTopLevelDomain);rtrn=true;}
if(rtrn){return{address:emailParts.address,domain:closestDomain,full:emailParts.address+"@"+closestDomain};}}
return false;},findClosestDomain:function(domain,domains,distanceFunction,threshold){threshold=threshold||this.topLevelThreshold;var dist;var minDist=Infinity;var closestDomain=null;if(!domain||!domains){return false;}
if(!distanceFunction){distanceFunction=this.sift4Distance;}
for(var i=0;i<domains.length;i++){if(domain===domains[i]){return domain;}
dist=distanceFunction(domain,domains[i]);if(dist<minDist){minDist=dist;closestDomain=domains[i];}}
if(minDist<=threshold&&closestDomain!==null){return closestDomain;}else{return false;}},sift4Distance:function(s1,s2,maxOffset){if(maxOffset===undefined){maxOffset=5;}
if(!s1||!s1.length){if(!s2){return 0;}
return s2.length;}
if(!s2||!s2.length){return s1.length;}
var l1=s1.length;var l2=s2.length;var c1=0;var c2=0;var lcss=0;var local_cs=0;var trans=0;var offset_arr=[];while((c1<l1)&&(c2<l2)){if(s1.charAt(c1)==s2.charAt(c2)){local_cs++;var isTrans=false;var i=0;while(i<offset_arr.length){var ofs=offset_arr[i];if(c1<=ofs.c1||c2<=ofs.c2){isTrans=Math.abs(c2-c1)>=Math.abs(ofs.c2-ofs.c1);if(isTrans)
{trans++;}else
{if(!ofs.trans){ofs.trans=true;trans++;}}
break;}else{if(c1>ofs.c2&&c2>ofs.c1){offset_arr.splice(i,1);}else{i++;}}}
offset_arr.push({c1:c1,c2:c2,trans:isTrans});}else{lcss+=local_cs;local_cs=0;if(c1!=c2){c1=c2=Math.min(c1,c2);}
for(var j=0;j<maxOffset&&(c1+j<l1||c2+j<l2);j++){if((c1+j<l1)&&(s1.charAt(c1+j)==s2.charAt(c2))){c1+=j-1;c2--;break;}
if((c2+j<l2)&&(s1.charAt(c1)==s2.charAt(c2+j))){c1--;c2+=j-1;break;}}}
c1++;c2++;if((c1>=l1)||(c2>=l2)){lcss+=local_cs;local_cs=0;c1=c2=Math.min(c1,c2);}}
lcss+=local_cs;return Math.round(Math.max(l1,l2)-lcss+trans);},splitEmail:function(email){email=email!==null?(email.replace(/^\s*/,'').replace(/\s*$/,'')):null;var parts=email.split('@');if(parts.length<2){return false;}
for(var i=0;i<parts.length;i++){if(parts[i]===''){return false;}}
var domain=parts.pop();var domainParts=domain.split('.');var sld='';var tld='';if(domainParts.length===0){return false;}else if(domainParts.length==1){tld=domainParts[0];}else{sld=domainParts[0];for(var j=1;j<domainParts.length;j++){tld+=domainParts[j]+'.';}
tld=tld.substring(0,tld.length-1);}
return{topLevelDomain:tld,secondLevelDomain:sld,domain:domain,address:parts.join('@')};},encodeEmail:function(email){var result=encodeURI(email);result=result.replace('%20',' ').replace('%25','%').replace('%5E','^').replace('%60','`').replace('%7B','{').replace('%7C','|').replace('%7D','}');return result;}};if(typeof module!=='undefined'&&module.exports){module.exports=Mailcheck;}
if(typeof define==="function"&&define.amd){define("mailcheck",[],function(){return Mailcheck;});}
if(typeof window!=='undefined'&&window.jQuery){(function($){$.fn.mailcheck=function(opts){var self=this;if(opts.suggested){var oldSuggested=opts.suggested;opts.suggested=function(result){oldSuggested(self,result);};}
if(opts.empty){var oldEmpty=opts.empty;opts.empty=function(){oldEmpty.call(null,self);};}
opts.email=this.val();Mailcheck.run(opts);};})(jQuery);};
const CaptchaSlider={param:{id:'captcha-slider',width:310,height:155,},resolve:function(){},reject:function(){},element:{},matchOffset:3,creatRandomBy:function(min,max){return Math.floor(Math.random()*(max-min+1))+min;},init:function init(param){var _this=this;this.param={id:param.id?param.id:'captcha-slider',width:param.width?param.width:310,height:param.height?param.height:155,image:param.image?param.image:'http://p6ygud9kn.bkt.clouddn.com/captcha-slider/canvas%20%28'+this.creatRandomBy(1,20)+'%29.jpg?imageView2/1/w/'+_this.param.width+'/h/'+_this.param.height+'/q/75|imageslim',imgSuccessCallback:param.imgSuccessCallback?param.imgSuccessCallback:()=>{},imgErrorCallback:param.imgErrorCallback?param.imgErrorCallback:()=>{}}
this.build();_this.resolve=param.success
_this.reject=param.failure
_this.imgSuccessCallback=param.imgSuccessCallback
_this.imgErrorCallback=param.imgErrorCallback},build:function build(){this.my_x_axis=0;this.renderElement();this.initCanvas(this.param.image);this.initCanvasLocation();this.initSliderDrag();},renderElement:function renderElement(){var _this=this;var captchaElement=document.getElementById(''+this.param.id);var refreshIcon=['<svg t="1530243424799" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6039" xmlns:xlink="http://www.w3.org/1999/xlink" ','width="23" height="23">','<path d="M55.935033 264.48948c0 0 85.897017-132.548409 221.81443-203.673173 135.916406-71.121743 303.368504-50.646859 413.187968 18.319527 109.819465 68.970415 146.791894 127.160016 146.791894 127.160016l94.59499-53.879895c0 0 19.576483-9.697092 19.576483 12.932142l0 338.379961c0 0 0 30.17399-22.837719 19.395191-19.210878-9.062571-226.959086-127.198289-292.424528-164.466828-35.950145-16.035251-4.365101-29.062068-4.365101-29.062068l91.284402-52.173738c0 0-52.068992-65.209619-128.278989-99.744682-81.576231-42.501826-157.948384-47.541735-251.497925-12.224097-61.002644 23.025054-132.823368 81.988166-184.553949 169.082716L55.935033 264.48948 55.935033 264.48948 55.935033 264.48948zM904.056909 711.697844c0 0-85.897017 132.550423-221.816444 203.671159-135.917413 71.12275-303.366489 50.651895-413.186961-18.315498-109.825508-68.972429-146.790886-127.165052-146.790886-127.165052L27.662591 823.768348c0 0-19.572454 9.703135-19.572454-12.932142L8.090137 472.459267c0 0 0-30.170968 22.831676-19.397205 19.211885 9.067607 226.965129 127.198289 292.430571 164.470856 35.950145 16.035251 4.366109 29.058039 4.366109 29.058039l-91.285409 52.175753c0 0 52.071006 65.206598 128.279996 99.744682 81.57321 42.498804 157.942341 47.540728 251.496918 12.222082 60.998616-23.026061 132.820346-81.983131 184.546898-169.082716L904.056909 711.697844 904.056909 711.697844 904.056909 711.697844zM904.056909 711.697844" p-id="6040" >','</path>','</svg>'].join('');var dragIcon=['<svg t="1530238656201" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2557" xmlns:xlink="http://www.w3.org/1999/xlink" ','width="23" height="23">','<path d="M244.363636 556.939636h469.248l-184.762181 170.565819a34.909091 34.909091 0 1 0 47.36 51.29309l250.391272-231.121454a34.955636 34.955636 0 0 0 0-51.293091l-250.391272-231.121455a34.862545 34.862545 0 0 0-49.338182 1.95491 34.909091 34.909091 0 0 0 1.978182 49.338181l184.762181 170.565819H244.363636a34.909091 34.909091 0 1 0 0 69.818181" p-id="2558">','</path>','</svg>'].join('');captchaElement.innerHTML=['<div id="captcha-slider-content" class="captcha-slider-content">','<div class="captcha-slider-refresh" id="slider-refresh"  style="left: '+(this.param.width-23-15)+'px;">'+refreshIcon+'</div>','<canvas width="'+this.param.width+'" height="'+this.param.height+'" id="captcha-slider-background" class="captcha-slider-background"></canvas>','<canvas width="'+this.param.width+'" height="'+this.param.height+'" id="captcha-slider-objective" class="captcha-slider-objective captcha-slider-position"></canvas>','<canvas width="'+this.param.width+'" height="'+this.param.height+'" id="captcha-slider-blockshadow" class="captcha-slider-blockshadow captcha-slider-position"></canvas>','<canvas width="'+this.param.width+'" height="'+this.param.height+'" id="captcha-slider-block" class="captcha-slider-block captcha-slider-position"></canvas>','</div>','<div class="captcha-slider-drag" style="width: '+(this.param.width-2)+'px;" id="slider-drag-content">','<div class="slider-drag-mask" id="drag-mask">','<div class="slider-drag-handle flex-center" id="drag-handle">'+dragIcon+'</div>','</div>','<div class="slider-drag-text" id="drag-text">Move slider to the right</div>','</div> '].join('');this.element.sliderBackground=document.getElementById('captcha-slider-background');this.element.objective=document.getElementById('captcha-slider-objective');this.element.block=document.getElementById('captcha-slider-block');this.element.blockshadow=document.getElementById('captcha-slider-blockshadow');this.element.dragContent=document.getElementById('slider-drag-content');this.element.dragMask=document.getElementById('drag-mask');this.element.dragHandle=document.getElementById('drag-handle');this.element.dragText=document.getElementById('drag-text');document.getElementById('slider-refresh').addEventListener('click',function(){_this.build();});},initCanvas:function initCanvas(imgUrl){var _this=this;var background_ctx=this.element.sliderBackground.getContext('2d');var objective_ctx=this.element.objective.getContext('2d');var block_ctx=this.element.block.getContext('2d');var blockshadow_ctx=this.element.blockshadow.getContext('2d');var PI=Math.PI;var block_width=33;var block_radius=7;var min_y_coordinate=block_radius*2+15;var max_y_coordinate=this.param.height-block_width;var random_y_coordinate=this.creatRandomBy(min_y_coordinate,max_y_coordinate);var min_x_coordinate=block_width+(block_radius*2)+15;var max_x_coordinate=this.param.width-block_width-(block_radius*2)-15;this.target_x_axis=this.creatRandomBy(min_x_coordinate,max_x_coordinate);var random_x_coordinate=this.target_x_axis;var imgElement=document.createElement('img');imgElement.onload=function(){background_ctx.drawImage(imgElement,0,0,_this.param.width,_this.param.height);block_ctx.drawImage(imgElement,0,0,_this.param.width,_this.param.height);_this.imgSuccessCallback()};imgElement.onerror=()=>{this.imgErrorCallback()}
imgElement.src=imgUrl;drawObjective();drawBlock();drawBlockshadow();function drawpuzzle(ctx,puzzle_width,puzzle_radius,x_coordinate,y_coordinate){ctx.moveTo(x_coordinate,y_coordinate);ctx.lineTo(x_coordinate+puzzle_width/2,y_coordinate);ctx.arc(x_coordinate+puzzle_width/2,y_coordinate-puzzle_radius+2,puzzle_radius,0,2*PI);ctx.lineTo(x_coordinate+puzzle_width/2,y_coordinate);ctx.lineTo(x_coordinate+puzzle_width,y_coordinate);ctx.lineTo(x_coordinate+puzzle_width,y_coordinate+puzzle_width/2);ctx.arc(x_coordinate+puzzle_width+puzzle_radius-2,y_coordinate+puzzle_width/2,puzzle_radius,0,2*PI);ctx.lineTo(x_coordinate+puzzle_width,y_coordinate+puzzle_width/2);ctx.lineTo(x_coordinate+puzzle_width,y_coordinate+puzzle_width);ctx.lineTo(x_coordinate,y_coordinate+puzzle_width);ctx.lineTo(x_coordinate,y_coordinate);}
function drawObjective(){objective_ctx.beginPath();drawpuzzle(objective_ctx,block_width,block_radius,random_x_coordinate,random_y_coordinate);objective_ctx.fillStyle='#f66';objective_ctx.fill();}
function drawBlock(){block_ctx.beginPath();drawpuzzle(block_ctx,block_width,block_radius,random_x_coordinate,random_y_coordinate);block_ctx.clip();}
function drawBlockshadow(){blockshadow_ctx.beginPath();blockshadow_ctx.shadowBlur=10;blockshadow_ctx.shadowColor="#f66";drawpuzzle(blockshadow_ctx,block_width,block_radius,random_x_coordinate,random_y_coordinate);blockshadow_ctx.fillStyle='#fff';blockshadow_ctx.fill();}},initCanvasLocation:function initCanvasLocation(){var targetLeftStyle=this.my_x_axis-this.target_x_axis;this.element.block.style.left=targetLeftStyle+'px';this.element.blockshadow.style.left=targetLeftStyle+'px';},initSliderDrag:function initSliderDrag(){var _this=this;var isMobiler=(function(){var isMobile=false;var myWidth=document.body.offsetWidth||document.documentElement.clientWidth||window.innerWidth;if(myWidth<=768){isMobile=true;}
['Android','iPhone','SymbianOS','Windows Phone','iPod'].map(function(terminal){if(window.navigator.userAgent.indexOf(terminal)>0){isMobile=true;}
return terminal;})
return isMobile})();var succeedIcon=['<svg t="1530238678016" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3369" xmlns:xlink="http://www.w3.org/1999/xlink" ','width="24" height="24">','<path d="M378.410667 850.450963C364.491852 850.450963 350.610963 845.293037 340.02963 834.939259L20.920889 523.529481C-0.279704 502.821926-0.279704 469.295407 20.920889 448.587852 42.121481 427.880296 76.48237 427.880296 97.682963 448.587852L378.410667 722.526815 925.75763 188.491852C946.958222 167.784296 981.319111 167.784296 1002.519704 188.491852 1023.720296 209.161481 1023.720296 242.688 1002.519704 263.395556L416.791704 834.939259C406.172444 845.293037 392.291556 850.450963 378.410667 850.450963L378.410667 850.450963Z" p-id="3370" ','fill="#fff">','</path>','</svg>'].join('');var failureIcon=['<svg t="1530238694639" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4162" xmlns:xlink="http://www.w3.org/1999/xlink" ','width="32" height="32">','<path d="M733.952 336.333l-46.285-46.285L512 465.664 336.333 290.048l-46.285 46.285L465.664 512 290.048 687.667l46.285 46.285L512 558.336l175.667 175.616 46.285-46.285L558.336 512z" p-id="4163" ','fill="#fff">','</path>','</svg>'].join('');var originX=0;var originY=0;var moveX=0;var moveY=0;var isMatch=false;var track=[];var dragLocationModifier=function(){_this.element.dragText.innerHTML='';_this.element.dragContent.classList.add('slider-drag-activate');_this.my_x_axis=moveX;_this.initCanvasLocation();_this.element.dragHandle.style.left=moveX+'px';_this.element.dragMask.style.width=moveX+'px';}
var handleMouseMove=function(event){var mouseOffset=0;if(isMobiler){mouseOffset=event.changedTouches[0].clientX-originX;}else{mouseOffset=event.x-originX}
if(mouseOffset>0&&mouseOffset<(_this.param.width-62)){moveX=mouseOffset;moveY=event.y-originY;}
track.push(moveY)
if(mouseOffset>=(_this.target_x_axis-_this.matchOffset)&&mouseOffset<=(_this.target_x_axis+_this.matchOffset)){isMatch=true;}else{isMatch=false;}
dragLocationModifier();};var handleMouseEnd=function(event){_this.element.dragContent.classList.remove('slider-drag-activate');if(isMatch){_this.element.dragContent.classList.add('slider-drag-succeed');_this.element.dragHandle.innerHTML=succeedIcon;_this.resolve();}else{_this.element.dragContent.classList.add('slider-drag-failure');_this.element.dragHandle.innerHTML=failureIcon;_this.reject();setTimeout(function(){_this.build();},1000);}
if(isMobiler){window.removeEventListener('touchmove',handleMouseMove);window.removeEventListener('touchend',handleMouseEnd);}else{window.removeEventListener('mousemove',handleMouseMove);window.removeEventListener('mouseup',handleMouseEnd);}};if(isMobiler){this.element.dragHandle.addEventListener('touchstart',function(event){originX=event.changedTouches[0].clientX;originY=event.changedTouches[0].clientY;window.addEventListener('touchmove',handleMouseMove);window.addEventListener('touchend',handleMouseEnd);});}else{this.element.dragHandle.addEventListener('mousedown',function(event){originX=event.x;originY=event.y;window.addEventListener('mousemove',handleMouseMove);window.addEventListener('mouseup',handleMouseEnd);});}}};
function clearSearchButtonToggle(searchField,buttonId){if($(searchField).val())$(buttonId).css('display','block');else $(buttonId).css('display','none');}
function clearSearchButtonEvents(searchField,buttonId){clearSearchButtonToggle(searchField,buttonId);$(searchField).on('input',()=>clearSearchButtonToggle(searchField,buttonId));$(buttonId).click(()=>$(searchField).val("").trigger("input"));};
var __assign=(this&&this.__assign)||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))
t[p]=s[p];}
return t;};return __assign.apply(this,arguments);};var defaults={lines:12,length:7,width:5,radius:10,scale:1.0,corners:1,color:'#000',fadeColor:'transparent',animation:'spinner-line-fade-default',rotate:0,direction:1,speed:1,zIndex:2e9,className:'spinner',top:'50%',left:'50%',shadow:'0 0 1px transparent',position:'absolute',};var Spinner=(function(){function Spinner(opts){if(opts===void 0){opts={};}
this.opts=__assign({},defaults,opts);}
Spinner.prototype.spin=function(target){this.stop();this.el=document.createElement('div');this.el.className=this.opts.className;this.el.setAttribute('role','progressbar');css(this.el,{position:this.opts.position,width:0,zIndex:this.opts.zIndex,left:this.opts.left,top:this.opts.top,transform:"scale("+this.opts.scale+")",});if(target){target.insertBefore(this.el,target.firstChild||null);}
drawLines(this.el,this.opts);return this;};Spinner.prototype.stop=function(){if(this.el){if(typeof requestAnimationFrame!=='undefined'){cancelAnimationFrame(this.animateId);}
else{clearTimeout(this.animateId);}
if(this.el.parentNode){this.el.parentNode.removeChild(this.el);}
this.el=undefined;}
return this;};return Spinner;}());function css(el,props){for(var prop in props){el.style[prop]=props[prop];}
return el;}
function getColor(color,idx){return typeof color=='string'?color:color[idx%color.length];}
function drawLines(el,opts){var borderRadius=(Math.round(opts.corners*opts.width*500)/1000)+'px';var shadow='none';if(opts.shadow===true){shadow='0 2px 4px #000';}
else if(typeof opts.shadow==='string'){shadow=opts.shadow;}
var shadows=parseBoxShadow(shadow);for(var i=0;i<opts.lines;i++){var degrees=~~(360/opts.lines*i+opts.rotate);var backgroundLine=css(document.createElement('div'),{position:'absolute',top:-opts.width/2+"px",width:(opts.length+opts.width)+'px',height:opts.width+'px',background:getColor(opts.fadeColor,i),borderRadius:borderRadius,transformOrigin:'left',transform:"rotate("+degrees+"deg) translateX("+opts.radius+"px)",});var delay=i*opts.direction/opts.lines/opts.speed;delay-=1/opts.speed;var line=css(document.createElement('div'),{width:'100%',height:'100%',background:getColor(opts.color,i),borderRadius:borderRadius,boxShadow:normalizeShadow(shadows,degrees),animation:1/opts.speed+"s linear "+delay+"s infinite "+opts.animation,});backgroundLine.appendChild(line);el.appendChild(backgroundLine);}}
function parseBoxShadow(boxShadow){var regex=/^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/;var shadows=[];for(var _i=0,_a=boxShadow.split(',');_i<_a.length;_i++){var shadow=_a[_i];var matches=shadow.match(regex);if(matches===null){continue;}
var x=+matches[2];var y=+matches[5];var xUnits=matches[4];var yUnits=matches[7];if(x===0&&!xUnits){xUnits=yUnits;}
if(y===0&&!yUnits){yUnits=xUnits;}
if(xUnits!==yUnits){continue;}
shadows.push({prefix:matches[1]||'',x:x,y:y,xUnits:xUnits,yUnits:yUnits,end:matches[8],});}
return shadows;}
function normalizeShadow(shadows,degrees){var normalized=[];for(var _i=0,shadows_1=shadows;_i<shadows_1.length;_i++){var shadow=shadows_1[_i];var xy=convertOffset(shadow.x,shadow.y,degrees);normalized.push(shadow.prefix+xy[0]+shadow.xUnits+' '+xy[1]+shadow.yUnits+shadow.end);}
return normalized.join(', ');}
function convertOffset(x,y,degrees){var radians=degrees*Math.PI/180;var sin=Math.sin(radians);var cos=Math.cos(radians);return[Math.round((x*cos+y*sin)*1000)/1000,Math.round((-x*sin+y*cos)*1000)/1000,];};
const ZLibraryRequest=function(url,data){let method='GET'
if(url instanceof Element||url instanceof jQuery){$form=$(url)
url=(data)?data.url||$form.attr('action'):$form.attr('action')
data={}
$.map($form.serializeArray(),function(n,i){if(n['name'].indexOf('[]')>=0){n['name']=n['name'].replace('[]','')
if(!data[n['name']]){data[n['name']]=[]}
data[n['name']].push(n['value'])}else{data[n['name']]=n['value'];}})
data=JSON.stringify(data)
method=$form.attr('method')}else if(data){data=JSON.stringify(data)
method=data?'POST':'GET'}
const request=new Request(url,{method:method,body:data})
return request};