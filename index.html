<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liu Lifu's Blog</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/themes.css">
    <script src="js/showdown.min.js"></script>
    <script src="js/theme-switcher.js"></script>
    <script src="config.js"></script>
    <meta name="description" content="Liu Lifu's personal blog">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body class="theme-default">
    <header>
        <nav class="site-nav">
            <div class="nav-links">
                <a href="index.html" class="active">Home</a>
                <a href="tags.html">Tags</a>
                <a href="https://liulifu.github.io/post.html?post=2024-12-05-about.md">About</a>
            </div>
        </nav>
    </header>

    <main class="content">
        <div id="post-list" class="post-list">
            <!-- Posts will be loaded dynamically -->
        </div>
    </main>

    <footer>
        <p>&copy; <span id="current-year"></span> Liu Lifu. All rights reserved.</p>
    </footer>

    <script>
        // Initialize theme switcher
        document.addEventListener('DOMContentLoaded', () => {
            ThemeSwitcher.init();
        });

        let allPosts = {};

        async function loadPosts() {
            try {
                const response = await fetch('metadata.json');
                const data = await response.json();
                allPosts = data.posts;

                // Sort posts by date, newest first
                const sortedPosts = Object.entries(allPosts)
                    .filter(([_, post]) => post.type === 'article')
                    .sort(([,a], [,b]) => new Date(b.date) - new Date(a.date));

                // Create post cards
                const postList = document.getElementById('post-list');
                postList.innerHTML = sortedPosts.map(([id, post]) => `
                    <article class="post-card">
                        <h2 class="post-title">
                            <a href="post.html?post=${id}">${post.title}</a>
                        </h2>
                        <div class="post-meta">
                            <span class="post-date">${new Date(post.date).toLocaleDateString('en-US', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            })}</span>
                            ${post.categories ? `
                                <span class="post-categories">
                                    in ${post.categories.map(cat => 
                                        `<a href="tags.html#${cat.toLowerCase()}">${cat}</a>`
                                    ).join(', ')}
                                </span>
                            ` : ''}
                        </div>
                        <p class="post-description">${post.description || ''}</p>
                        <div class="post-tags">
                            ${(post.tags || []).map(tag => 
                                `<a href="tags.html#${tag.toLowerCase()}" class="tag">${tag}</a>`
                            ).join('')}
                        </div>
                    </article>
                `).join('');

            } catch (error) {
                console.error('Error loading posts:', error);
                document.getElementById('post-list').innerHTML = '<p>Error loading posts</p>';
            }
        }

        // Set current year
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Load posts when page loads
        loadPosts();
    </script>
    <script>
        // 防止样式文件缓存
        function loadStyles() {
            const timestamp = new Date().getTime();
            const existingLink = document.querySelector('link[rel="stylesheet"]');
            existingLink.href = `styles.css?v=${timestamp}`;
        }

        // 页面加载时执行
        window.addEventListener('load', loadStyles);
    </script>
</body>
</html>
